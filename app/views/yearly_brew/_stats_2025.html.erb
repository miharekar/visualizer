<div class="overflow-hidden relative w-full via-rose-700 to-amber-300 shadow-2xl sm:rounded-3xl bg-linear-to-br from-indigo-950 shadow-neutral-900/10">
  <div class="absolute inset-0 opacity-50 pointer-events-none">
    <div class="absolute top-6 -left-20 w-56 h-56 rounded-full bg-amber-200/30 blur-3xl dark:bg-amber-800/30"></div>
    <div class="absolute bottom-0 right-6 w-64 h-64 rounded-full bg-sky-200/30 blur-3xl"></div>
  </div>
  <div class="relative py-10 px-6 sm:py-14 sm:px-12 lg:px-16">
    <div class="flex flex-col gap-6 lg:flex-row lg:justify-between lg:items-center">
      <div class="space-y-4 max-w-2xl lg:max-w-md">
        <div class="inline-flex gap-2 items-center py-1 px-3 text-xs font-semibold text-white uppercase rounded-full bg-white/10 tracking-[0.25em]">
          <span class="inline-block bg-amber-300 rounded-full size-2"></span>
          Year in Review · 2025
        </div>
        <h2 class="font-serif text-4xl font-semibold leading-tight text-white sm:text-5xl">
          Daily Grind 2025<%= ": #{@yearly_brew.user.display_name}" unless personal %>
        </h2>
        <p class="text-base leading-7 sm:text-lg text-white/90">
          Here’s what happened at <%= personal ? "the bar" : "#{@yearly_brew.user.display_name.split.first.capitalize}'s bar" %> this year: the shots pulled, the beans that kept getting ground, and the routines that stuck.
        </p>
      </div>
      <div class="grid gap-4 w-full sm:grid-cols-2 lg:w-120">
        <% summary_metrics_2025(@yearly_brew, personal:).each do |metric| %>
          <div class="overflow-hidden p-4 rounded-2xl border shadow-inner transition hover:shadow-none group bg-white/10 border-white/20 shadow-black/20 hover:bg-white/15">
            <p class="text-sm font-medium text-white/75"><%= metric[:label] %></p>
            <p class="mt-2 text-3xl font-semibold tracking-tight text-white"><%= metric[:value] %></p>
            <% if metric[:detail].present? %>
              <p class="inline-flex gap-2 items-center mt-1 text-xs font-semibold text-white/80">
                <span class="inline-block w-1.5 h-1.5 bg-amber-300 rounded-full"></span>
                <%= metric[:detail] %>
              </p>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
<div class="grid grid-cols-1 gap-6 lg:grid-cols-2">
  <% highlight_cards_2025(@yearly_brew, personal:).each do |key, card| %>
    <% stat = card[:stat] %>
    <% next if stat.blank? %>
    <div class="overflow-hidden relative bg-white border shadow-2xl transition sm:rounded-2xl border-neutral-200/80 shadow-neutral-900/10 dark:border-neutral-800 dark:bg-neutral-900">
      <div class="absolute inset-0 via-transparent dark:via-transparent bg-linear-to-br from-terracotta-50/60 to-white/60 dark:from-terracotta-900/30 dark:to-neutral-900/30"></div>
      <div class="flex relative flex-col gap-3 p-6 sm:p-8">
        <div class="inline-flex gap-2 items-center self-start py-1 px-3 text-xs font-semibold uppercase rounded-full bg-terracotta-100 tracking-[0.25em] text-terracotta-700 dark:bg-terracotta-900/60 dark:text-terracotta-200">
          <%= card[:title] %>
        </div>
        <p class="text-2xl font-semibold text-neutral-900 dark:text-neutral-50">
          <% if key == :best_rated_coffee %>
            <%= stat.bean_brand %> <%= stat.bean_type %> (<%= stat.espresso_enjoyment %>/100)
          <% else %>
            <%= stat %>
          <% end %>
        </p>
        <p class="text-sm leading-6 text-neutral-600 dark:text-neutral-400"><%= card[:body] %></p>
      </div>
    </div>
  <% end %>
</div>
<% if @yearly_brew.user.coffee_management_enabled? || personal %>
  <div class="from-amber-50 via-white border border-amber-100 shadow-2xl sm:rounded-3xl bg-linear-to-br to-sky-50 text-neutral-900 shadow-neutral-900/10 dark:border-amber-900/40 dark:bg-linear-to-br dark:from-amber-950/30 dark:via-slate-950 dark:to-slate-900 dark:text-neutral-50">
    <div class="py-8 px-6 sm:py-12 sm:px-10">
      <% if @yearly_brew.user.coffee_management_enabled? %>
        <div class="flex flex-col gap-2 sm:flex-row sm:justify-between sm:items-center">
          <div>
            <p class="text-xs font-semibold uppercase tracking-[0.2em] text-terracotta-700 dark:text-terracotta-300">Coffee management</p>
            <p class="text-2xl font-semibold">Tracked <%= possessive(personal) %> beans, got better stats!</p>
            <p class="mt-2 text-sm leading-6 text-neutral-600 dark:text-neutral-200">
              See which roasters and bags fueled <%= possessive(personal) %> brews this year.
            </p>
          </div>
        </div>
        <div class="grid grid-cols-1 gap-4 mt-6 sm:grid-cols-3">
          <% coffee_management_cards_2025(@yearly_brew, personal:).each do |card| %>
            <div class="p-4 rounded-2xl border border-amber-100 shadow-inner transition bg-white/70 shadow-neutral-900/10 dark:border-amber-900/40 dark:bg-slate-900/60 dark:shadow-black/40">
              <p class="text-sm text-neutral-600 dark:text-neutral-200"><%= card[:label] %></p>
              <p class="mt-2 text-2xl font-semibold text-neutral-900 dark:text-neutral-50"><%= card[:value] %></p>
              <p class="mt-1 text-sm leading-6 text-neutral-700 dark:text-neutral-300"><%= card[:description] %></p>
            </div>
          <% end %>
        </div>
      <% elsif personal %>
        <div class="flex flex-col gap-3 sm:flex-row sm:justify-between sm:items-center">
          <div class="space-y-1">
            <p class="text-xs font-semibold uppercase tracking-[0.2em] text-terracotta-700 dark:text-terracotta-300">Unlock coffee management</p>
            <p class="text-lg font-semibold text-neutral-900 dark:text-neutral-50">Track your beans, unlock richer stats</p>
            <p class="text-sm leading-6 text-neutral-600 dark:text-neutral-300">
              Attach shots to coffee bags to see roaster/bag breakdowns, discovery counts, bean-level trends, and more.
            </p>
          </div>
          <div>
            <% if Current.user.premium? %>
              <%= link_to "Enable coffee management", edit_profile_path, class: "inline-flex items-center gap-2 rounded-full bg-terracotta-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-terracotta-500 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-terracotta-600" %>
            <% else %>
              <%= link_to "Enable coffee management", premium_index_path(anchor: "coffee-management"), class: "inline-flex items-center gap-2 rounded-full bg-terracotta-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-terracotta-500 focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-terracotta-600" %>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
<% end %>
<div class="grid grid-cols-1 gap-6 lg:grid-cols-2">
  <div class="p-6 bg-white border shadow-2xl transition sm:rounded-2xl border-neutral-200 shadow-neutral-900/10 dark:border-neutral-800 dark:bg-neutral-900">
    <div class="flex justify-between items-center">
      <div>
        <p class="text-xs font-semibold uppercase tracking-[0.2em] text-terracotta-700 dark:text-terracotta-400">Weekly rhythm</p>
        <p class="mt-1 text-xl font-semibold text-neutral-900 dark:text-neutral-50">When the caffeine spikes</p>
      </div>
    </div>
    <div id="weekly-rhythm-chart" class="mt-4 h-52" data-controller="weekly-rhythm-chart" data-chart-data="<%= @yearly_brew.shots_per_day_of_week.to_json %>"></div>
  </div>
  <div class="p-6 bg-white border shadow-2xl transition sm:rounded-2xl border-neutral-200 shadow-neutral-900/10 dark:border-neutral-800 dark:bg-neutral-900">
    <div class="flex justify-between items-center">
      <div>
        <p class="text-xs font-semibold uppercase tracking-[0.2em] text-terracotta-700 dark:text-terracotta-400">Mood tracker</p>
        <p class="mt-1 text-xl font-semibold text-neutral-900 dark:text-neutral-50">Month-by-month enjoyment</p>
      </div>
    </div>
    <div id="monthly-enjoyment-chart" class="mt-4 h-52" data-controller="monthly-enjoyment-chart" data-chart-data="<%= @yearly_brew.monthly_enjoyments.to_json %>"></div>
  </div>
</div>
<div class="p-6 border shadow-2xl sm:rounded-3xl border-neutral-200 bg-white/90 shadow-neutral-900/10 dark:border-neutral-800 dark:bg-neutral-900">
  <div class="flex flex-col gap-4 sm:flex-row sm:justify-between sm:items-center">
    <div class="space-y-1">
      <p class="text-xs font-semibold uppercase tracking-[0.2em] text-terracotta-700 dark:text-terracotta-400">Habits & streaks</p>
      <p class="text-xl font-semibold text-neutral-900 dark:text-neutral-50">How <%= possessive(personal) %> coffee ritual evolved</p>
      <p class="text-sm text-neutral-600 dark:text-neutral-400">Momentum, cadence, and all the times <%= personal ? "you" : "they" %> reached for the beans.</p>
    </div>
    <div class="flex flex-wrap gap-2 items-center text-sm text-neutral-600 dark:text-neutral-400">
      <span class="py-1 px-3 rounded-full bg-terracotta-100 text-terracotta-800 dark:bg-terracotta-900/50 dark:text-terracotta-200"><%= @yearly_brew.shots_count %> total shots</span>
      <span class="py-1 px-3 rounded-full bg-neutral-100 text-neutral-800 dark:bg-neutral-800 dark:text-neutral-200"><%= @yearly_brew.amount_brewed %> kg brewed</span>
    </div>
  </div>
  <div class="grid grid-cols-1 gap-4 mt-6 sm:grid-cols-2 lg:grid-cols-4">
    <% habit_cards_2025(@yearly_brew, personal:).each do |card| %>
      <div class="p-4 bg-white rounded-xl border shadow-inner transition border-neutral-200 shadow-neutral-200/60 dark:border-neutral-800 dark:bg-neutral-950/70 dark:shadow-black/40">
        <p class="text-sm text-neutral-500 dark:text-neutral-400"><%= card[:label] %></p>
        <p class="mt-2 text-2xl font-semibold text-neutral-900 dark:text-neutral-50"><%= card[:value] %></p>
        <p class="mt-1 text-sm leading-6 text-neutral-600 dark:text-neutral-400"><%= card[:description] %></p>
      </div>
    <% end %>
  </div>
</div>
